import{j as e,b as R}from"./index-d63ee538.js";import{r as l}from"./vendor-021dee49.js";import{u as G,a as M}from"./router-3052588b.js";import{P as B}from"./PhotoIcon-4f8783ce.js";import"./utils-917b1704.js";const J=()=>{const j=G(),T=M(),{dogId:A,profileImage:u,galleryImages:k}=T.state||{},[y,c]=l.useState(1),[m,h]=l.useState(null),[d,w]=l.useState(""),[N,v]=l.useState(!1),[x,D]=l.useState(!1),[f,b]=l.useState(0),[I]=l.useState(3);l.useEffect(()=>{const t=new Date().toDateString(),a=localStorage.getItem("aiDailyUsage");if(a){const r=JSON.parse(a);r.date===t?b(r.count):(localStorage.setItem("aiDailyUsage",JSON.stringify({date:t,count:0})),b(0))}else localStorage.setItem("aiDailyUsage",JSON.stringify({date:t,count:0}))},[]);const C=(t,a=800,r=.8)=>new Promise((S,p)=>{const n=document.createElement("canvas"),g=n.getContext("2d"),o=new Image;o.onload=()=>{try{let{width:s,height:i}=o;s>a&&(i=i*a/s,s=a),n.width=s,n.height=i,g.drawImage(o,0,0,s,i);const P=n.toDataURL("image/jpeg",r);URL.revokeObjectURL(o.src),S(P)}catch(s){p(s)}},o.onerror=()=>{p(new Error("Failed to load image"))},o.src=URL.createObjectURL(t)}),O=async t=>{const a=t.target.files[0];if(a&&!x){D(!0);try{if(a.size>5*1024*1024){alert("Image file is too large. Please select an image smaller than 5MB.");return}const r=await C(a,800,.8);h(r),c(2)}catch(r){console.error("Error processing image:",r),alert("Error processing image. Please try again.")}finally{D(!1),t.target.value=""}}},E=async()=>{if(f>=I){alert("You have reached your daily limit of 3 AI image generations.");return}const t=["different dog","another dog","change breed","make it a","turn into","different animal"],a=d.toLowerCase();for(const r of t)if(a.includes(r)){alert("Please only describe what to ADD or MODIFY to your dog. Do not ask to change the dog itself into something else.");return}v(!0);try{const r=m.split(",")[1],p={contents:[{role:"user",parts:[{inlineData:{mimeType:m.startsWith("data:image/png")?"image/png":"image/jpeg",data:r}},{text:`CRITICAL INSTRUCTIONS: Transform THIS EXACT DOG (keep it identical) with these additions/modifications: ${d}

                MANDATORY REQUIREMENTS:
                1. PRESERVE the EXACT SAME DOG - same breed, same size, same facial features, same markings
                2. ONLY ADD/MODIFY what is specifically requested: ${d}
                3. DO NOT change the dog's breed, species, or core physical characteristics
                4. DO NOT replace the dog with a different animal
                5. The result must be recognizably the SAME individual dog
                6. Keep all distinctive features of this specific dog (facial structure, ear shape, coat patterns, etc.)
                
                WHAT TO DO: Add/modify only: ${d}
                WHAT NOT TO DO: Change the dog's breed, replace with different dog, change fundamental dog characteristics
                
                Return only the transformed image with the same dog.`}]}],generationConfig:{responseModalities:["TEXT","IMAGE"]}},n=await fetch("https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash-preview-image-generation:generateContent?key=AIzaSyBApCOlYZGVoSA6R68JQ9BZ-dY4EEv-GK8",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(p)});if(!n.ok)throw new Error(`HTTP error! status: ${n.status}`);const g=await n.json();let o=null;if(g.candidates&&g.candidates[0]&&g.candidates[0].content){const s=g.candidates[0].content.parts;for(const i of s)if(i.inlineData&&i.inlineData.mimeType&&i.inlineData.mimeType.startsWith("image/")){o=`data:${i.inlineData.mimeType};base64,${i.inlineData.data}`;break}}if(o){c(3),h(o);const s=f+1;b(s);const i=new Date().toDateString();localStorage.setItem("aiDailyUsage",JSON.stringify({date:i,count:s}))}else alert("Failed to generate image. Please try again.")}catch(r){console.error("Error generating image:",r),alert("Error generating image. Please try again.")}finally{v(!1)}},U=()=>{localStorage.setItem("aiGeneratedResult",JSON.stringify({image:m,dogId:A})),j(-1)},L=()=>{j(-1)};return e.jsxs("div",{className:"min-h-screen bg-white dark:bg-gray-900",children:[e.jsx("div",{className:"sticky top-0 bg-white dark:bg-gray-900 border-b border-gray-200 dark:border-gray-700 px-4 py-4 z-10",children:e.jsxs("div",{className:"flex items-center",children:[e.jsxs("button",{onClick:L,className:"flex items-center space-x-2 text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white transition-colors touch-manipulation active:scale-95 min-h-[44px] px-2",children:[e.jsx("svg",{className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})}),e.jsx("span",{className:"font-medium",children:"Back"})]}),e.jsx("div",{className:"flex-1 text-center",children:e.jsxs("h1",{className:"text-xl font-bold text-gray-900 dark:text-white flex items-center justify-center",children:[e.jsx(R,{className:"h-6 w-6 text-purple-500 mr-2"}),"AI Dog Transformer"]})}),e.jsx("div",{className:"w-16"})]})}),e.jsxs("div",{className:"p-6 max-w-lg mx-auto pb-20",children:[y===1&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-16 h-16 bg-purple-100 dark:bg-purple-900 rounded-full flex items-center justify-center mx-auto mb-3",children:e.jsx("span",{className:"text-2xl",children:"📸"})}),e.jsx("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white mb-2",children:"Select a base image"}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-300",children:"Choose a photo of your dog to transform"})]}),e.jsxs("div",{className:"space-y-3",children:[u&&e.jsxs("button",{onClick:()=>{h(u),c(2)},className:"flex items-center space-x-4 p-4 border border-gray-300 dark:border-gray-600 rounded-xl hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors w-full touch-manipulation active:scale-95 min-h-[72px]",children:[e.jsx("img",{src:u,alt:"Profile",className:"w-14 h-14 rounded-full object-cover border-2 border-primary-200 dark:border-primary-800"}),e.jsxs("div",{className:"text-left flex-1",children:[e.jsx("span",{className:"text-sm font-medium text-gray-900 dark:text-white block",children:"Use current profile image"}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Main profile photo"})]})]}),k&&k.map((t,a)=>e.jsxs("button",{onClick:()=>{h(t),c(2)},className:"flex items-center space-x-4 p-4 border border-gray-300 dark:border-gray-600 rounded-xl hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors w-full touch-manipulation active:scale-95 min-h-[72px]",children:[e.jsx("img",{src:t,alt:`Gallery ${a+1}`,className:"w-14 h-14 rounded-lg object-cover border-2 border-gray-200 dark:border-gray-600"}),e.jsxs("div",{className:"text-left flex-1",children:[e.jsxs("span",{className:"text-sm font-medium text-gray-900 dark:text-white block",children:["Use gallery image ",a+1]}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"From photo gallery"})]})]},a)),e.jsxs("label",{className:`cursor-pointer flex items-center space-x-4 p-4 border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-xl hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors touch-manipulation active:scale-95 min-h-[72px] ${x?"opacity-50 cursor-not-allowed":""}`,children:[e.jsx("div",{className:"w-14 h-14 bg-gray-100 dark:bg-gray-600 rounded-lg flex items-center justify-center",children:x?e.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-gray-400"}):e.jsx(B,{className:"h-8 w-8 text-gray-400 dark:text-gray-500"})}),e.jsxs("div",{className:"text-left flex-1",children:[e.jsx("span",{className:"text-sm font-medium text-gray-900 dark:text-white block",children:x?"Processing image...":"Upload new image"}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Choose from device"})]}),e.jsx("input",{type:"file",accept:"image/*",onChange:O,className:"hidden",disabled:x})]})]})]}),y===2&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-16 h-16 bg-blue-100 dark:bg-blue-900 rounded-full flex items-center justify-center mx-auto mb-3",children:e.jsx("span",{className:"text-2xl",children:"✏️"})}),e.jsx("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white mb-2",children:"Describe your transformation"}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-300",children:"What would you like to add or change?"})]}),e.jsxs("div",{className:"flex items-center space-x-3 mb-3",children:[e.jsx("img",{src:m,alt:"Selected",className:"w-12 h-12 rounded-lg object-cover"}),e.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-300",children:"This dog will be kept the same"})]}),e.jsx("div",{className:"bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded-lg p-3 mb-3",children:e.jsxs("p",{className:"text-xs text-yellow-800 dark:text-yellow-200",children:[e.jsx("strong",{children:"Important:"})," The AI will keep your dog's breed, size, and features exactly the same. Only describe what you want to ADD or CHANGE (like clothing, background, accessories)."]})}),e.jsx("textarea",{value:d,onChange:t=>w(t.target.value),placeholder:`Examples:
• wearing a red superhero cape
• sitting in a beautiful garden
• wearing sunglasses and a hat
• with colorful butterflies around
• in a winter snow scene`,className:"w-full p-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white",rows:5}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsxs("button",{onClick:()=>c(1),className:"flex items-center space-x-2 px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 text-gray-700 dark:text-gray-300 touch-manipulation active:scale-95 min-h-[48px]",children:[e.jsx("svg",{className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})}),e.jsx("span",{children:"Back"})]}),e.jsx("button",{onClick:E,disabled:!d.trim()||N,className:"flex-1 px-4 py-3 bg-blue-500 text-white rounded-lg hover:bg-blue-600 disabled:opacity-50 disabled:cursor-not-allowed touch-manipulation active:scale-95 min-h-[48px] font-medium",children:N?e.jsxs(e.Fragment,{children:[e.jsxs("svg",{className:"animate-spin -ml-1 mr-3 h-5 w-5 text-white inline",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Generating..."]}):"Generate"})]})]}),y===3&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-16 h-16 bg-green-100 dark:bg-green-900 rounded-full flex items-center justify-center mx-auto mb-3",children:e.jsx("span",{className:"text-2xl",children:"🎉"})}),e.jsx("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white mb-2",children:"Transformation complete!"}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-300",children:"Your AI-generated image is ready"})]}),e.jsx("img",{src:m,alt:"Generated",className:"w-full rounded-lg shadow-lg"}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsxs("button",{onClick:()=>{c(2),w("")},className:"flex items-center space-x-2 px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 text-gray-700 dark:text-gray-300 touch-manipulation active:scale-95 min-h-[48px]",children:[e.jsx("svg",{className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})}),e.jsx("span",{children:"Try Again"})]}),e.jsx("button",{onClick:U,className:"flex-1 px-4 py-3 bg-green-500 text-white rounded-lg hover:bg-green-600 touch-manipulation active:scale-95 min-h-[48px] font-medium",children:"Use This Image"})]})]}),e.jsx("div",{className:"mt-8 text-center",children:e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:["Daily usage: ",f,"/",I]})})]})]})};export{J as default};
