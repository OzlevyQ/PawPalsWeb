import{e as o,j as R}from"./index-d63ee538.js";import{r}from"./vendor-021dee49.js";import{Q as I}from"./QRScanner-2e1766c7.js";import{gardenService as b}from"./gardenService-8e5619dd.js";import{u as h,a as v}from"./router-3052588b.js";import"./utils-917b1704.js";import"./CameraIcon-e10f98e6.js";import"./ArrowPathIcon-a9aaab64.js";const y=()=>{const[l,a]=r.useState(!1),[u,t]=r.useState(null),i=h(),g=r.useCallback(()=>{a(!0)},[]),f=r.useCallback(()=>{a(!1)},[]),S=r.useCallback(async c=>{try{const{type:e,gardenId:n,rawData:s}=c;if(e==="garden"&&n){t(c);try{const d=await b.getGarden(n);d.garden&&d.garden.isActive?i(`/scan/checkin/${n}`,{state:{garden:d.garden,fromQRScan:!0}}):o.error("This garden is currently inactive or unavailable")}catch(d){console.error("Error validating garden:",d),o.error("Garden not found or unavailable")}}else o.error("Invalid QR code format")}catch(e){console.error("Error processing scan:",e),o.error("Failed to process QR code")}finally{a(!1)}},[i]),p=r.useCallback(c=>{console.error("QR Scan error:",c),o.error("Scanner error occurred"),a(!1)},[]),m=r.useCallback(()=>{a(!0)},[]),Q=r.useCallback(()=>{a(!1)},[]);return{isScanning:l,lastScannedData:u,startScanning:g,stopScanning:f,handleScanSuccess:S,handleScanError:p,openScanner:m,closeScanner:Q}},A=()=>{var c;const l=h(),a=v(),{handleScanSuccess:u,handleScanError:t}=y(),[i,g]=r.useState(!0),f=((c=a.state)==null?void 0:c.autoLaunched)||!1,S=e=>{console.log("🔍 QR Code scanned in QRScannerScreen:",e);try{const n=p(e);console.log("📝 Parsed garden ID:",n),n?(console.log("✅ Valid garden QR detected, processing..."),o.success("🎉 Garden QR code detected!"),u({type:"garden",gardenId:n,rawData:e})):(console.warn("❌ QR code does not match garden format:",e),o.error("❌ Invalid QR code format. Please scan a garden QR code."))}catch(n){console.error("QR processing error:",n),o.error("Failed to process QR code"),t==null||t(n)}},p=e=>{console.log("🔍 Parsing QR data:",e);const n=e.match(/\/garden\/([a-fA-F0-9]{24})/i);if(n)return console.log("✅ Found garden ID in URL format:",n[1]),n[1];try{const s=JSON.parse(e);if(s.type==="garden_checkin"&&s.gardenId)return console.log("✅ Found garden ID in JSON format:",s.gardenId),s.gardenId}catch{}return/^[a-fA-F0-9]{24}$/.test(e)?(console.log("✅ Found direct garden ID:",e),e):e.includes("garden")||e.includes("dog")||e.includes("park")?(console.log("⚠️ Test mode: accepting garden-related QR for demo"),"507f1f77bcf86cd799439011"):(console.log("❌ No garden ID found in QR data"),null)},m=()=>{g(!1),l(f?"/dashboard":-1)},Q=()=>{g(!1),m()};return R.jsx("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900",children:R.jsx(I,{isOpen:i,onScan:S,onClose:Q})})};export{A as default};
