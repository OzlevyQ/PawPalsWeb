import{u as F,k as $,j as e,L as V,A as q,J as B,P as W}from"./index-d63ee538.js";import{r as a}from"./vendor-021dee49.js";import{b as z,u as G}from"./router-3052588b.js";import{U as H}from"./UserIcon-725f4b63.js";import"./utils-917b1704.js";const A=()=>{var k,S,T,E;const{chatId:o}=z(),C=G(),{user:p}=F(),[d,f]=a.useState([]),[c,m]=a.useState(""),[D,b]=a.useState(!0),[x,y]=a.useState(!1),[j,w]=a.useState(""),[s,I]=a.useState(null);a.useState(!1);const[U,v]=a.useState(!1),N=a.useRef(null),g=a.useRef(null),P=["ðŸ‘‹","ðŸ˜Š","â¤ï¸","ðŸ‘","ðŸ˜‚","ðŸ•","ðŸŽ‰","ðŸ”¥"];a.useEffect(()=>{if(o){h();const t=setInterval(()=>{h(!1)},8e3);return()=>clearInterval(t)}},[o]),a.useEffect(()=>{R()},[d]);const R=()=>{var t;(t=N.current)==null||t.scrollIntoView({behavior:"smooth"})},h=async(t=!0)=>{var i;try{t&&b(!0);const l=(await $.get(`/chats/${o}/messages`)).data.messages;if(JSON.stringify(l)!==JSON.stringify(d)&&f(l),l.length>0&&!s){const n=(i=l.find(u=>u.sender._id!==p._id))==null?void 0:i.sender;n&&I({participants:[n]})}}catch(r){t&&(w("Failed to load messages"),console.error("Error fetching messages:",r))}finally{t&&b(!1)}},_=async t=>{if(t.preventDefault(),!c.trim()||x)return;y(!0);const i=c.trim();m("");try{const r={message:{text:i,type:"text"}},l=await $.post(`/chats/${o}/messages`,r);f(n=>[...n,l.data.message]),setTimeout(()=>{h(!1)},500)}catch(r){w("Failed to send message"),console.error("Error sending message:",r),m(i)}finally{y(!1)}},L=t=>new Date(t).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"}),O=t=>t.sender._id===p._id,J=t=>{m(t.target.value),g.current&&clearTimeout(g.current),v(!0),g.current=setTimeout(()=>{v(!1)},2e3)};return D?e.jsx(V,{}):e.jsxs("div",{className:"flex flex-col h-full bg-white dark:bg-gray-800 lg:rounded-3xl shadow-lg overflow-hidden",children:[e.jsx("div",{className:"flex-shrink-0 bg-gradient-to-r from-blue-600 via-purple-600 to-pink-600 dark:from-blue-700 dark:via-purple-700 dark:to-pink-700 text-white p-4 lg:rounded-t-3xl",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("button",{onClick:()=>C(-1),className:"p-2 hover:bg-white hover:bg-opacity-20 rounded-full transition-all duration-200",children:e.jsx(q,{className:"h-5 w-5 text-white"})}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs("div",{className:"relative",children:[(k=s==null?void 0:s.participants[0])!=null&&k.profileImage?e.jsx("img",{src:s.participants[0].profileImage,alt:`${s.participants[0].firstName} ${s.participants[0].lastName}`,className:"h-10 w-10 rounded-full object-cover border-2 border-white"}):e.jsx("div",{className:"h-10 w-10 rounded-full bg-white bg-opacity-20 flex items-center justify-center border-2 border-white",children:e.jsx(H,{className:"h-6 w-6 text-white"})}),e.jsx("div",{className:"absolute -bottom-1 -right-1 w-3 h-3 bg-green-400 rounded-full border-2 border-white"})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-white text-lg",children:s!=null&&s.participants[0]?`${s.participants[0].firstName} ${s.participants[0].lastName}`:"Chat"}),e.jsx("p",{className:"text-blue-100 text-sm",children:"Online now"})]})]})]}),e.jsx("button",{className:"p-2 hover:bg-white hover:bg-opacity-20 rounded-full transition-all duration-200",children:e.jsx(B,{className:"h-5 w-5 text-white"})})]})}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-4 bg-gradient-to-b from-gray-50 to-white dark:from-gray-800 dark:to-gray-900",children:[j&&e.jsx("div",{className:"mb-4 p-4 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-2xl",children:e.jsx("p",{className:"text-red-700 dark:text-red-400 text-sm font-medium",children:j})}),d.length===0?e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsxs("div",{className:"text-center p-8",children:[e.jsx("div",{className:"w-20 h-20 bg-gradient-to-br from-blue-100 to-purple-100 dark:from-blue-900 dark:to-purple-900 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx("span",{className:"text-3xl",children:"ðŸ’¬"})}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-2",children:"No messages yet"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400 text-sm",children:"Start the conversation!"})]})}):e.jsxs("div",{className:"space-y-4",children:[d.map((t,i)=>{var n,u,M;const r=O(t),l=i===0||new Date(t.createdAt).getTime()-new Date(d[i-1].createdAt).getTime()>3e5;return e.jsxs("div",{children:[l&&e.jsx("div",{className:"text-center mb-4",children:e.jsx("span",{className:"text-xs text-gray-500 dark:text-gray-400 bg-white dark:bg-gray-800 px-3 py-1 rounded-full shadow-sm border border-gray-200 dark:border-gray-700",children:L(t.createdAt)})}),e.jsxs("div",{className:`flex items-end space-x-2 ${r?"justify-end":"justify-start"}`,children:[!r&&e.jsx("div",{className:"w-8 h-8 flex-shrink-0 mb-1",children:(n=s==null?void 0:s.participants[0])!=null&&n.profileImage?e.jsx("img",{src:s.participants[0].profileImage,alt:"",className:"w-8 h-8 rounded-full object-cover"}):e.jsx("div",{className:"w-8 h-8 bg-gradient-to-br from-gray-400 to-gray-600 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-white text-xs font-semibold",children:((M=(u=s==null?void 0:s.participants[0])==null?void 0:u.firstName)==null?void 0:M[0])||"U"})})}),e.jsxs("div",{className:`max-w-[75%] px-4 py-3 rounded-2xl shadow-sm ${r?"bg-gradient-to-r from-blue-600 to-purple-600 text-white rounded-br-md":"bg-white dark:bg-gray-700 text-gray-900 dark:text-white rounded-bl-md border border-gray-200 dark:border-gray-600"}`,children:[e.jsx("p",{className:"text-sm break-words leading-relaxed",children:t.content.text}),e.jsx("p",{className:`text-xs mt-1 ${r?"text-blue-100":"text-gray-500 dark:text-gray-400"}`,children:new Date(t.createdAt).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"})})]})]})]},t._id)}),U&&e.jsxs("div",{className:"flex items-end space-x-2 justify-start",children:[e.jsx("div",{className:"w-8 h-8 flex-shrink-0 mb-1",children:(S=s==null?void 0:s.participants[0])!=null&&S.profileImage?e.jsx("img",{src:s.participants[0].profileImage,alt:"",className:"w-8 h-8 rounded-full object-cover"}):e.jsx("div",{className:"w-8 h-8 bg-gradient-to-br from-gray-400 to-gray-600 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-white text-xs font-semibold",children:((E=(T=s==null?void 0:s.participants[0])==null?void 0:T.firstName)==null?void 0:E[0])||"U"})})}),e.jsx("div",{className:"bg-white dark:bg-gray-700 px-4 py-3 rounded-2xl rounded-bl-md border border-gray-200 dark:border-gray-600 shadow-sm",children:e.jsxs("div",{className:"flex space-x-1",children:[e.jsx("div",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce"}),e.jsx("div",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce",style:{animationDelay:"0.1s"}}),e.jsx("div",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce",style:{animationDelay:"0.2s"}})]})})]}),e.jsx("div",{ref:N})]})]}),e.jsxs("div",{className:"flex-shrink-0 p-4 bg-white dark:bg-gray-800 border-t border-gray-200 dark:border-gray-700 lg:rounded-b-3xl",children:[e.jsx("div",{className:"flex items-center space-x-2 mb-3 overflow-x-auto pb-2",children:P.map((t,i)=>e.jsx("button",{onClick:()=>m(r=>r+t),className:"flex-shrink-0 w-10 h-10 bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 rounded-full flex items-center justify-center transition-all duration-200 hover:scale-110",children:e.jsx("span",{className:"text-lg",children:t})},i))}),e.jsxs("form",{onSubmit:_,className:"flex items-center space-x-3",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx("input",{type:"text",value:c,onChange:J,placeholder:"Type a message...",className:"w-full px-4 py-3 bg-gray-100 dark:bg-gray-700 border-0 rounded-2xl text-gray-900 dark:text-white placeholder-gray-500 dark:placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 transition-all duration-200",disabled:x}),x&&e.jsx("div",{className:"absolute right-3 top-1/2 transform -translate-y-1/2",children:e.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-2 border-blue-600 border-t-transparent"})})]}),e.jsx("button",{type:"submit",disabled:!c.trim()||x,className:"inline-flex items-center justify-center w-12 h-12 bg-gradient-to-r from-blue-600 to-purple-600 text-white rounded-2xl hover:from-blue-700 hover:to-purple-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-200 transform hover:scale-105",children:e.jsx(W,{className:"h-5 w-5"})})]})]})]})},ee=()=>e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-purple-50 via-white to-pink-50 dark:from-gray-900 dark:via-gray-800 dark:to-gray-900 lg:py-8",children:[e.jsx("div",{className:"lg:hidden h-screen",children:e.jsx(A,{})}),e.jsx("div",{className:"hidden lg:block max-w-4xl mx-auto px-4 sm:px-6 lg:px-8",children:e.jsx("div",{className:"h-[600px] rounded-3xl overflow-hidden shadow-2xl",children:e.jsx(A,{})})})]});export{ee as default};
