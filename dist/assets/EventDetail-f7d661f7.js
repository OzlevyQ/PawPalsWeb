import{u as ie,e as i,j as e,A as oe,p as le,M as de,b as ce,C as B,l as me,F as xe,i as ge}from"./index-d63ee538.js";import{r as h}from"./vendor-021dee49.js";import{b as pe}from"./SkeletonLoading-3b438a19.js";import{eventService as j}from"./eventService-0703f6fe.js";import{b as ue,u as be}from"./router-3052588b.js";import{C as _}from"./ClockIcon-d6d0aaad.js";import{X as G}from"./XCircleIcon-3fe8bf8c.js";import{T as he}from"./TagIcon-32febfd4.js";import{I as fe}from"./InformationCircleIcon-c0454e63.js";import{U as V}from"./UserIcon-725f4b63.js";import"./utils-917b1704.js";const Se=()=>{var D,I,A,S,T,$,L;const{id:x}=ue(),d=be(),{user:o}=ie(),[r,k]=h.useState(null),[g,p]=h.useState(!1),[Y,w]=h.useState(!0);h.useEffect(()=>{f()},[x]);const f=async()=>{try{w(!0);const t=await j.getEventById(x);k(t.data||t)}catch(t){console.error("Error loading event:",t),i.error("Failed to load event details"),d("/events")}finally{w(!1)}},H=async()=>{var t,s;if(!o){i.error("Please log in to register for events"),d("/login");return}p(!0);try{const a=await j.registerForEvent(x);a.status==="pending"?i.success("Registered! Your registration is pending organizer approval"):i.success("Successfully registered for the event! 🎉"),k(n=>({...n,participants:[...n.participants,{user:o._id,status:a.status||"pending",registeredAt:new Date().toISOString()}]})),setTimeout(()=>f(),500)}catch(a){console.error("Error registering for event:",a),i.error(((s=(t=a.response)==null?void 0:t.data)==null?void 0:s.error)||"Failed to register for event")}finally{p(!1)}},X=async()=>{var t,s;p(!0);try{await j.cancelEventRegistration(x),i.success("Registration cancelled successfully"),await f()}catch(a){console.error("Error cancelling registration:",a),i.error(((s=(t=a.response)==null?void 0:t.data)==null?void 0:s.error)||"Failed to cancel registration")}finally{p(!1)}},Z=()=>{J()},J=()=>{var t,s,a,n,O,P;if(r)try{const u=new Date(`${r.eventDate}T${r.startTime}`),z=new Date(`${r.eventDate}T${r.endTime}`);if(isNaN(u.getTime())||isNaN(z.getTime())){i.error("Invalid date format");return}const y=c=>c.toISOString().replace(/[-:]/g,"").replace(/\.\d{3}/,""),ae=[r.description,"",`Location: ${((t=r.garden)==null?void 0:t.name)||"Not specified"}`,`Organizer: ${(s=r.organizer)==null?void 0:s.firstName} ${(a=r.organizer)==null?void 0:a.lastName}`,(n=r.organizer)!=null&&n.email?`Email: ${(O=r.organizer)==null?void 0:O.email}`:"",r.maxParticipants?`Spots: ${r.participantCount||0}/${r.maxParticipants}`:"","","Created via Pwaradise App 🐾"].filter(Boolean).join("\\n"),b=["BEGIN:VCALENDAR","VERSION:2.0","PRODID:-//PawConnect App//Event Calendar//EN","CALSCALE:GREGORIAN","METHOD:PUBLISH","BEGIN:VEVENT",`UID:${r._id}@pawconnect.app`,`DTSTAMP:${y(new Date)}`,`DTSTART:${y(u)}`,`DTEND:${y(z)}`,`SUMMARY:${r.title}`,`DESCRIPTION:${ae}`,`LOCATION:${((P=r.garden)==null?void 0:P.name)||""}`,"STATUS:CONFIRMED","CATEGORIES:Dog Parks,Pet Events,Social",`URL:${window.location.origin}/events/${r._id}`,"BEGIN:VALARM","TRIGGER:-PT1H","ACTION:DISPLAY","DESCRIPTION:Reminder: Dog event starts in 1 hour! 🐕","END:VALARM","END:VEVENT","END:VCALENDAR"].join(`\r
`),U=navigator.userAgent,M=/iPad|iPhone|iPod/.test(U),F=/Android/.test(U);if(M||F)try{const c=`data:text/calendar;charset=utf8,${encodeURIComponent(b)}`;if(M)window.location.href=c,i.success('Redirected to Calendar! Choose "Add to All Events" or "Add to This Event Only"');else if(F){const ne=new Blob([b],{type:"text/calendar"}),q=URL.createObjectURL(ne),m=document.createElement("a");m.href=q,m.download=`${r.title.replace(/[^a-zA-Z0-9\u0590-\u05FF]/g,"_")}.ics`,document.body.appendChild(m),m.click(),document.body.removeChild(m),URL.revokeObjectURL(q),i.success("File downloaded! Open it to add to your calendar")}}catch(c){console.error("Error opening mobile calendar:",c),E(b)}else E(b)}catch(u){console.error("Error creating calendar event:",u),i.error("Failed to create calendar event")}},E=t=>{try{const s=new Blob([t],{type:"text/calendar;charset=utf-8"}),a=URL.createObjectURL(s),n=document.createElement("a");n.href=a,n.download=`${r.title.replace(/[^a-zA-Z0-9\u0590-\u05FF\s]/g,"_")}.ics`,n.style.display="none",document.body.appendChild(n),n.click(),document.body.removeChild(n),URL.revokeObjectURL(a),i.success("Calendar file downloaded! Open it to add the event to your calendar",{duration:4e3})}catch(s){console.error("Error downloading ICS file:",s),i.error("Failed to download calendar file")}},K=()=>{var t;return!r||!o?!1:(t=r.participants)==null?void 0:t.some(s=>{var a;return((a=s.user)==null?void 0:a._id)===o._id||s.user===o._id})},Q=()=>{var s;if(!r||!o)return null;const t=(s=r.participants)==null?void 0:s.find(a=>{var n;return((n=a.user)==null?void 0:n._id)===o._id||a.user===o._id});return(t==null?void 0:t.status)||null},R=t=>new Date(t).toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"}),W=t=>{const s={meetup:{icon:"👥",label:"Community Meetup",color:"from-blue-500 to-cyan-600"},training:{icon:"🎓",label:"Training Session",color:"from-purple-500 to-pink-600"},competition:{icon:"🏆",label:"Competition",color:"from-red-500 to-orange-600"},adoption:{icon:"💚",label:"Adoption Event",color:"from-green-500 to-emerald-600"},social:{icon:"🎉",label:"Social Event",color:"from-yellow-500 to-amber-600"},educational:{icon:"📚",label:"Educational",color:"from-indigo-500 to-blue-600"},other:{icon:"🌟",label:"Special Event",color:"from-gray-500 to-slate-600"}};return s[t]||s.other},ee=t=>({pending:"bg-yellow-100 dark:bg-yellow-900/30 text-yellow-800 dark:text-yellow-300 border-yellow-200 dark:border-yellow-700",approved:"bg-green-100 dark:bg-green-900/30 text-green-800 dark:text-green-300 border-green-200 dark:border-green-700",rejected:"bg-red-100 dark:bg-red-900/30 text-red-800 dark:text-red-300 border-red-200 dark:border-red-700"})[t]||"bg-gray-100 dark:bg-gray-700 text-gray-800 dark:text-gray-300 border-gray-200 dark:border-gray-600",re=t=>({pending:"Pending Approval",approved:"Approved",rejected:"Rejected"})[t]||t,te=t=>{const s={upcoming:{bg:"bg-green-500",text:"Upcoming",icon:"🔜"},ongoing:{bg:"bg-blue-500",text:"Live Now",icon:"🔴"},completed:{bg:"bg-gray-500",text:"Completed",icon:"✅"},cancelled:{bg:"bg-red-500",text:"Cancelled",icon:"❌"}};return s[t]||s.upcoming};if(Y)return e.jsx(pe,{});if(!r)return e.jsx("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white mb-4",children:"Event not found"}),e.jsx("button",{onClick:()=>d("/events"),className:"text-purple-600 hover:text-purple-800 dark:text-purple-400 dark:hover:text-purple-300",children:"Back to events"})]})});const l=Q(),C=K(),se=!C&&r.status==="upcoming"&&new Date<new Date(r.registrationDeadline||r.eventDate),v=te(r.status),N=W(r.eventType);return e.jsx("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900",children:e.jsxs("div",{className:"max-w-lg mx-auto",children:[e.jsxs("div",{className:`bg-gradient-to-r ${N.color} dark:from-purple-700 dark:to-pink-700 mx-4 mt-4 rounded-3xl p-6 text-white relative overflow-hidden`,children:[e.jsx("div",{className:"absolute -top-6 -right-6 opacity-20",children:e.jsx("div",{className:"text-8xl",children:N.icon})}),e.jsxs("div",{className:"relative z-10",children:[e.jsxs("button",{onClick:()=>d("/events"),className:"flex items-center text-white/80 hover:text-white transition-colors mb-4 p-2 rounded-xl bg-white/20 hover:bg-white/30",children:[e.jsx(oe,{className:"h-4 w-4 mr-2"}),"Back to Events"]}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsxs("span",{className:`${v.bg} px-3 py-1 rounded-full text-white text-sm font-medium flex items-center gap-1`,children:[e.jsx("span",{children:v.icon}),v.text]}),e.jsx("span",{className:"bg-white/20 px-3 py-1 rounded-full text-sm",children:N.label})]}),e.jsx("h1",{className:"text-2xl font-bold mb-3 line-clamp-2",children:r.title}),e.jsxs("div",{className:"grid grid-cols-1 gap-2 text-sm text-white/90",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(le,{className:"h-4 w-4 mr-2"}),R(r.eventDate)]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(_,{className:"h-4 w-4 mr-2"}),r.startTime," - ",r.endTime]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(de,{className:"h-4 w-4 mr-2"}),((D=r.garden)==null?void 0:D.name)||"Location TBA"]})]})]})]})]}),e.jsxs("div",{className:"p-4 space-y-4",children:[e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-3xl border border-gray-100 dark:border-gray-700 p-6",children:[e.jsxs("h3",{className:"text-lg font-bold text-gray-900 dark:text-white mb-4 flex items-center",children:[e.jsx(ce,{className:"h-5 w-5 mr-2 text-purple-600"}),"Event Registration"]}),C?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:`p-4 rounded-2xl border ${ee(l)}`,children:[e.jsxs("div",{className:"flex items-center justify-center",children:[l==="approved"&&e.jsx(B,{className:"h-5 w-5 mr-2"}),l==="pending"&&e.jsx(_,{className:"h-5 w-5 mr-2"}),l==="rejected"&&e.jsx(G,{className:"h-5 w-5 mr-2"}),e.jsx("span",{className:"font-bold",children:re(l)})]}),l==="approved"&&e.jsx("p",{className:"text-sm mt-2 text-center opacity-75",children:"You're registered for this event"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("button",{onClick:Z,className:"flex items-center justify-center px-4 py-3 bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-300 border border-blue-200 dark:border-blue-600 rounded-2xl font-medium hover:bg-blue-200 dark:hover:bg-blue-900/50 transition-all",children:[e.jsx(me,{className:"h-4 w-4 mr-2"}),"Add to Calendar"]}),e.jsxs("button",{onClick:X,disabled:g,className:"flex items-center justify-center px-4 py-3 bg-red-100 dark:bg-red-900/30 text-red-700 dark:text-red-300 border border-red-200 dark:border-red-600 rounded-2xl font-medium hover:bg-red-200 dark:hover:bg-red-900/50 disabled:opacity-50 disabled:cursor-not-allowed transition-all",children:[g?e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-red-700 dark:border-red-300 mr-2"}):e.jsx(G,{className:"h-4 w-4 mr-2"}),"Cancel"]})]})]}):se?e.jsx("button",{onClick:H,disabled:g,className:"w-full bg-gradient-to-r from-purple-600 to-pink-600 text-white py-4 px-6 rounded-2xl font-bold hover:from-purple-700 hover:to-pink-700 disabled:opacity-50 disabled:cursor-not-allowed transition-all transform hover:scale-105 shadow-lg",children:g?e.jsxs("div",{className:"flex items-center justify-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-white mr-2"}),"Registering..."]}):e.jsxs("div",{className:"flex items-center justify-center",children:[e.jsx(xe,{className:"h-5 w-5 mr-2"}),"Register for Event"]})}):e.jsxs("div",{className:"text-center py-4",children:[e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:o?r.status!=="upcoming"?"Event is not active":new Date>=new Date(r.registrationDeadline||r.eventDate)?"Registration closed":"Registration not available":"Please log in to register"}),!o&&e.jsx("button",{onClick:()=>d("/login"),className:"mt-3 text-purple-600 hover:text-purple-800 dark:text-purple-400 dark:hover:text-purple-300 font-medium",children:"Log In Now"})]}),r.registrationDeadline&&e.jsx("div",{className:"mt-6 pt-6 border-t border-gray-100 dark:border-gray-700",children:e.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:[e.jsx("strong",{children:"Registration deadline:"}),e.jsx("br",{}),R(r.registrationDeadline)]})})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-3xl border border-gray-100 dark:border-gray-700 p-6",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900 dark:text-white mb-4",children:"Event Description"}),e.jsx("p",{className:"text-gray-700 dark:text-gray-300 leading-relaxed whitespace-pre-wrap",children:r.description}),r.tags&&r.tags.length>0&&e.jsxs("div",{className:"mt-6 pt-6 border-t border-gray-100 dark:border-gray-700",children:[e.jsxs("div",{className:"flex items-center mb-3",children:[e.jsx(he,{className:"h-5 w-5 mr-2 text-purple-600"}),e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white",children:"Tags"})]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:r.tags.map((t,s)=>e.jsx("span",{className:"px-3 py-1 bg-purple-100 dark:bg-purple-900/30 text-purple-700 dark:text-purple-300 rounded-full text-sm font-medium",children:t},s))})]})]}),((I=r.organizerMessages)==null?void 0:I.welcomeMessage)&&e.jsxs("div",{className:"bg-gradient-to-br from-purple-50 to-pink-50 dark:from-purple-900/20 dark:to-pink-900/20 border-2 border-purple-200 dark:border-purple-700 rounded-3xl p-6",children:[e.jsxs("div",{className:"flex items-center mb-4",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-purple-500 to-pink-500 rounded-full flex items-center justify-center mr-3",children:e.jsx("span",{className:"text-white text-lg",children:"💬"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-bold text-gray-900 dark:text-white",children:"Message from Organizer"}),e.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:[(A=r.organizer)==null?void 0:A.firstName," ",(S=r.organizer)==null?void 0:S.lastName]})]})]}),e.jsx("div",{className:"bg-white/60 dark:bg-gray-800/60 backdrop-blur rounded-2xl p-4 border border-purple-100 dark:border-purple-600",children:e.jsxs("p",{className:"text-gray-800 dark:text-gray-200 leading-relaxed whitespace-pre-wrap italic",children:['"',r.organizerMessages.welcomeMessage,'"']})})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-3xl border border-gray-100 dark:border-gray-700 p-6",children:[e.jsxs("h2",{className:"text-xl font-bold text-gray-900 dark:text-white mb-4 flex items-center",children:[e.jsx(ge,{className:"h-6 w-6 mr-2 text-purple-600"}),"Participants"]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"bg-gradient-to-br from-green-50 to-green-100 dark:from-green-900/20 dark:to-green-800/20 rounded-2xl p-4 text-center border border-green-200 dark:border-green-700",children:[e.jsx("div",{className:"text-3xl font-bold text-green-700 dark:text-green-400",children:r.participantCount||0}),e.jsx("div",{className:"text-sm text-green-600 dark:text-green-400 mt-1",children:"Approved"})]}),e.jsxs("div",{className:"bg-gradient-to-br from-blue-50 to-blue-100 dark:from-blue-900/20 dark:to-blue-800/20 rounded-2xl p-4 text-center border border-blue-200 dark:border-blue-700",children:[e.jsx("div",{className:"text-3xl font-bold text-blue-700 dark:text-blue-400",children:r.maxParticipants||"∞"}),e.jsx("div",{className:"text-sm text-blue-600 dark:text-blue-400 mt-1",children:"Total Spots"})]})]}),r.isFull&&e.jsx("div",{className:"mt-4 p-3 bg-yellow-50 dark:bg-yellow-900/30 border border-yellow-200 dark:border-yellow-700 rounded-2xl",children:e.jsxs("p",{className:"text-sm text-yellow-800 dark:text-yellow-300 font-medium flex items-center",children:[e.jsx(fe,{className:"h-4 w-4 mr-2"}),"Event is full - you can join the waiting list"]})})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-3xl border border-gray-100 dark:border-gray-700 p-6",children:[e.jsxs("h2",{className:"text-xl font-bold text-gray-900 dark:text-white mb-4 flex items-center",children:[e.jsx(V,{className:"h-6 w-6 mr-2 text-purple-600"}),"Event Organizer"]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-16 h-16 bg-gradient-to-br from-purple-500 to-pink-500 rounded-full flex items-center justify-center mr-4",children:e.jsx(V,{className:"h-8 w-8 text-white"})}),e.jsxs("div",{children:[e.jsxs("p",{className:"font-bold text-lg text-gray-900 dark:text-white",children:[(T=r.organizer)==null?void 0:T.firstName," ",($=r.organizer)==null?void 0:$.lastName]}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:(L=r.organizer)==null?void 0:L.email})]})]})]}),r.requirements&&e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-3xl border border-gray-100 dark:border-gray-700 p-6",children:[e.jsx("h3",{className:"text-lg font-bold text-gray-900 dark:text-white mb-4",children:"Event Requirements"}),e.jsxs("div",{className:"space-y-3",children:[r.requirements.vaccinationRequired&&e.jsxs("div",{className:"flex items-center text-sm",children:[e.jsx(B,{className:"h-5 w-5 mr-2 text-green-600"}),e.jsx("span",{className:"text-gray-700 dark:text-gray-300",children:"Current vaccination required"})]}),r.requirements.sizeRestrictions&&r.requirements.sizeRestrictions.length>0&&e.jsxs("div",{className:"text-sm",children:[e.jsx("span",{className:"font-medium text-gray-700 dark:text-gray-300",children:"Size restrictions:"}),e.jsx("ul",{className:"list-disc list-inside mt-1 text-gray-600 dark:text-gray-400 ml-5",children:r.requirements.sizeRestrictions.map((t,s)=>e.jsx("li",{children:t},s))})]}),r.requirements.ageRestrictions&&e.jsxs("div",{className:"text-sm",children:[e.jsx("span",{className:"font-medium text-gray-700 dark:text-gray-300",children:"Age restrictions:"}),e.jsxs("p",{className:"text-gray-600 dark:text-gray-400 ml-5",children:[r.requirements.ageRestrictions.min&&`Minimum: ${r.requirements.ageRestrictions.min} months`,r.requirements.ageRestrictions.min&&r.requirements.ageRestrictions.max&&" | ",r.requirements.ageRestrictions.max&&`Maximum: ${r.requirements.ageRestrictions.max} months`]})]})]})]})]})]})})};export{Se as default};
